## Access Codes

API endpoints used in this section

https://kyc.myverify.info/api/token-auth/

https://kyc.myverify.info/api/business/businesses/

https://kyc.myverify.info/api/business/businesses/UUID/access-codes/

https://kyc.myverify.info/api/business/businesses/UUID/access-codes/nkt123/




Access Codes are provided by Netki for your customers to access the correct path through the MyVerify app.  You will want to keep track of who you give the access codes to as this will allow you to track which of your customers has gone through the KYC process.  Each access code can be used once and only provides access to the system and a way to look people up after they have completed the KYC process.  Access codes are generated by your account executive.  Please contact them for more codes and for best practices regarding using the codes.

To pull a list of all of the access codes that are associated with your system you is a two step process (one step after you've gone through the identification step and can be skipped if you ran the sample code from the authentication page and have your business ID from there).

#### Step 1

Authenticate to get your access token and then hit the business end point to get your business ID:


```bash
curl -X "POST" "https://kyc.myverify.info/api/token-auth/" \
     -H 'Content-Type: application/json; charset=utf-8' \
     -d $'{
  "username": "client_username",
  "password": "client_password"
}'
```


```bash
curl -X "GET" "https://kyc.myverify.info/api/business/businesses/" \
     -H 'Authorization: Bearer TOKEN'
```

```json
{
  "count": 2,
  "next": null,
  "previous": null,
  "results": [
    {
      "id": "604e1738-4716-4bdd-867b-4942186b1e1c",
      "app_context": {
        "id": 7,
        "required_fields": [
          {
            "id": 4,
            "options": [
              {
                "id": 3,
                "created": "2018-04-16T22:26:35.268006Z",
                "updated": "2018-04-16T22:26:35.283482Z",
                "is_active": true,
                "key": "true",
                "position": 0,
                "label": "Yes",
                "language_code": "en"
              },
              {
                "id": 4,
                "created": "2018-04-16T22:26:35.268006Z",
                "updated": "2018-04-16T22:26:35.283482Z",
                "is_active": true,
                "key": "false",
                "position": 0,
                "label": "No",
                "language_code": "en"
              }
            ],
            "created": "2018-04-16T22:26:35.233747Z",
            "updated": "2018-04-16T22:26:35.258242Z",
            "is_active": true,
            "name": "is_accredited_investor",
            "data_type": "list",
            "regex": null,
            "keypad": "list",
            "label": "Are you an Accredited Investor (US Only)",
            "description": "Are you an Accredited Investor (US Only)",
            "language_code": "en"
          },
          {
            "id": 3,
            "options": [
              {
                "id": 2,
                "created": "2018-04-16T22:26:35.268006Z",
                "updated": "2018-04-16T22:26:35.283482Z",
                "is_active": true,
                "key": "corporate_entity",
                "position": 2,
                "label": "Corporate Entity",
                "language_code": "en"
              },
              {
                "id": 1,
                "created": "2018-04-16T22:26:35.268006Z",
                "updated": "2018-04-16T22:26:35.283482Z",
                "is_active": true,
                "key": "private_party",
                "position": 3,
                "label": "Private Party",
                "language_code": "en"
              }
            ],
            "created": "2018-04-16T22:26:35.233747Z",
            "updated": "2018-04-16T22:26:35.258242Z",
            "is_active": true,
            "name": "investor_type",
            "data_type": "list",
            "regex": null,
            "keypad": "list",
            "label": "Investor Type",
            "description": "The type of investor that you are. Either corporate or private party.",
            "language_code": "en"
          }
        ],
        "individual_form_fields": [
          {
            "id": 1,
            "created": "2018-04-30T23:36:03.098331Z",
            "updated": "2018-04-30T23:36:03.098351Z",
            "is_active": true,
            "name": "first_name",
            "data_type": "string",
            "regex": null,
            "keypad": null,
            "label": "First Name",
            "description": "What is your given name?",
            "language_code": "en"
          }
        ],
        "corporate_form_fields": [
          {
            "id": 1,
            "created": "2018-04-30T23:36:03.098331Z",
            "updated": "2018-04-30T23:36:03.098351Z",
            "is_active": true,
            "name": "first_name",
            "data_type": "string",
            "regex": null,
            "keypad": null,
            "label": "First Name",
            "description": "What is your given name?",
            "language_code": "en"
          }
        ],
        "created": "2018-04-27T18:33:17.657524Z",
        "updated": "2018-04-30T23:36:23.006425Z",
        "is_active": true,
        "logo_dark": "https://netkipearldev.s3.amazonaws.com/businesses/assets/logo_netki_mark_solo_small.png?AWSAccessKeyId=AKIAJQRUEJLMVY3TS25Q&Signature=3wCcxLNSTeM6F9K8FfY2qGZ2gxw%3D&Expires=1526672772",
        "logo_light": "https://netkipearldev.s3.amazonaws.com/businesses/assets/logo_netki_mark_solo_small.png?AWSAccessKeyId=AKIAJQRUEJLMVY3TS25Q&Signature=3wCcxLNSTeM6F9K8FfY2qGZ2gxw%3D&Expires=1526672772",
        "redirect_backlink": null,
        "access_code_prefix": "nkt",
        "preferred_restart_contact_method": "sms",
        "restart_limit": "20",
        "phone_pin_timeout": 120,
        "phone_retry_attempt_limit": 1,
        "phone_use_automatic_bypass": false,
        "accredited_investor_flow": "accredited_vi",
        "business": "604e1738-4716-4bdd-867b-4942186b1e1c",
        "welcome_message": "Welcome to MyVerify!",
        "completed_message": "Thanks for signing up!",
        "sms_verification_message": null,
        "sms_corporate_onboard_message": null,
        "declined_feedback_sms": null,
        "sms_accredited_message": null,
        "language_code": "en"
      },
      "country_blacklist": [],
      "business_documents": [],
      "business_addresses": [],
      "business_media_references": [],
      "business_data_sources": [],
      "business_json_objects": [],
      "errors": [],
      "created": "2018-04-27T18:29:02.798424Z",
      "updated": "2018-04-27T18:31:50.661200Z",
      "is_active": true,
      "name": "Netkitesting",
      "status": "open",
      "established_date": "2018-04-27",
      "business_type": null,
      "email": null,
      "country_code": null,
      "primary_account": 12,
      "parent_business": null,
      "contettype": 30
    },
    {
      "id": "f634fe08-0961-499a-a49d-74e684a883c3",
      "app_context": null,
      "country_blacklist": [],
      "business_documents": [
        {
          "id": "fb05e805-fe1b-4d3e-bc52-80af3a4ffcf4",
          "errors": [],
          "created": "2018-05-17T20:11:02.738941Z",
          "updated": "2018-05-17T20:11:02.746797Z",
          "is_active": true,
          "document": "https://netkipearldev.s3.amazonaws.com/businesses/documents/fb05e805-fe1b-4d3e-bc52-80af3a4ffcf4.corporate_agreement.pdf?AWSAccessKeyId=AKIAJQRUEJLMVY3TS25Q&Signature=899XCd97Aqh870fPATL0HkHVDZs%3D&Expires=1526672772",
          "expiration_date": null,
          "expiration_time_in_seconds": null,
          "business": "f634fe08-0961-499a-a49d-74e684a883c3",
          "document_type": 2,
          "document_classification": null,
          "contettype": 39
        },
        {
          "id": "116024f6-63a7-4d8b-82dc-7497cfb3dfad",
          "errors": [],
          "created": "2018-05-17T20:11:03.412531Z",
          "updated": "2018-05-17T20:11:03.420331Z",
          "is_active": true,
          "document": "https://netkipearldev.s3.amazonaws.com/businesses/documents/116024f6-63a7-4d8b-82dc-7497cfb3dfad.BusinessDocument.pdf?AWSAccessKeyId=AKIAJQRUEJLMVY3TS25Q&Signature=nPyX53YvRQHGF9CSMpsjvYXECcs%3D&Expires=1526672772",
          "expiration_date": null,
          "expiration_time_in_seconds": null,
          "business": "f634fe08-0961-499a-a49d-74e684a883c3",
          "document_type": 2,
          "document_classification": null,
          "contettype": 39
        }
      ],
      "business_addresses": [],
      "business_media_references": [],
      "business_data_sources": [],
      "business_json_objects": [],
      "errors": [],
      "created": "2018-05-17T20:11:01.290232Z",
      "updated": "2018-05-17T20:11:04.196182Z",
      "is_active": true,
      "name": "Johnny's Post",
      "status": "open",
      "established_date": null,
      "business_type": "investor",
      "email": null,
      "country_code": null,
      "primary_account": null,
      "parent_business": "604e1738-4716-4bdd-867b-4942186b1e1c",
      "contettype": 30
    }
  ]
}
```

#### Step 2

To get a list of all of your access codes use the following:

```bash
curl -X "GET" "https://kyc.myverify.info/api/business/businesses/604e1738-4716-4bdd-867b-4942186b1e1c/access-codes/" \
     -H 'Authorization: Bearer TOKEN'
```

```json
{
  "count": 1,
  "next": null,
  "previous": null,
  "results": [
    {
      "id": "4524f4ad-de8e-482e-a2c5-d60a76a27c62",
      "code": "nkt123",
      "identity": null,
      "parent_code": null,
      "child_codes": [],
      "is_active": true,
      "business": "604e1738-4716-4bdd-867b-4942186b1e1c",
      "created": "2018-04-27T23:24:47.784740Z",
      "updated": "2018-04-27T23:24:47.784757Z"
    }
  ]
}
```

To get information about a specific access code use:

```bash
curl -X "GET" "https://kyc.myverify.info/api/business/businesses/604e1738-4716-4bdd-867b-4942186b1e1c/access-codes/nkt123/" \
     -H 'Authorization: Bearer TOKEN'
```


This is what an access code would like if it hasn't been used yet.

```json
{
  "id": "4524f4ad-de8e-482e-a2c5-d60a76a27c62",
  "code": "nkt123",
  "identity": null,
  "parent_code": null,
  "child_codes": [],
  "is_active": true,
  "business": "604e1738-4716-4bdd-867b-4942186b1e1c",
  "created": "2018-04-27T23:24:47.784740Z",
  "updated": "2018-04-27T23:24:47.784757Z"
}
```


This is what an access code would like after it has been used.

```json
{
  "id": "4524f4ad-de8e-482e-a2c5-d60a76a27c62",
  "code": "nkt123",
  "identity": "f25766e2-24b9-4d73-807b-ce9e50194874",
  "parent_code": null,
  "child_codes": [],
  "is_active": false,
  "business": "604e1738-4716-4bdd-867b-4942186b1e1c",
  "created": "2018-04-27T23:24:47.784740Z",
  "updated": "2018-04-28T00:02:24.333916Z"
}
```


You can also use the following to look up a transaction by a specific access code:

```bash
curl -X "GET" "https://kyc.myverify.info/api/transactions/?search=nkk655" \
     -H 'Authorization: Bearer TOKEN'
```

```json
{
  "count": 1,
  "next": null,
  "previous": null,
  "results": [
    {
      "id": "c99f15a1-b2ca-4ba0-87c6-7751b3e508ce",
      "client": "604e1738-4716-4bdd-867b-4942186b1e1c",
      "transaction_identity": {
        "id": "d92a4fad-cd70-47d5-aed9-df71f060c66f",
        "identity_emails": [
          {
            "id": "57104497-05f0-4c06-af91-2165029b7cdd",
            "created": "2018-07-16T21:54:16.451559Z",
            "updated": "2018-07-16T21:54:16.451578Z",
            "is_active": true,
            "email": "test@email.com",
            "identity": "d92a4fad-cd70-47d5-aed9-df71f060c66f"
          }
        ],
        "identity_phone_numbers": [
          {
            "id": "41a94c89-6a0f-4c4e-8311-6e383b149441",
            "created": "2018-07-16T21:54:16.470313Z",
            "updated": "2018-07-16T21:54:16.470330Z",
            "is_active": true,
            "phone_number": "+14258675309",
            "identity": "d92a4fad-cd70-47d5-aed9-df71f060c66f"
          }
        ],
        "identity_addresses": [
          {
            "id": "a60a3b49-00ac-4b6a-ae13-3962709dc3c7",
            "created": "2018-07-16T21:54:16.432748Z",
            "updated": "2018-07-16T21:54:16.432767Z",
            "is_active": true,
            "address": "12345 Oompa Loompa Rd",
            "unit": "",
            "city": "Dallas",
            "state": "TX",
            "postalcode": "40110",
            "score": 0,
            "country_code": "US",
            "identity": "d92a4fad-cd70-47d5-aed9-df71f060c66f"
          }
        ],
        "identity_documents": [],
        "identity_data_sources": [
          {
            "id": "d19c7f06-450e-4713-912f-b445a209aaf5",
            "created": "2018-07-16T21:54:16.498962Z",
            "updated": "2018-07-16T21:54:16.498980Z",
            "is_active": true,
            "raw_data": "{\"face_match_score\":\"29\"}",
            "reference_url": "",
            "comply_search_matches": 0,
            "score": "29",
            "identity": "d92a4fad-cd70-47d5-aed9-df71f060c66f",
            "data_provider": 3
          }
        ],
        "identity_data_listings": [],
        "identity_media_references": [],
        "identity_access_code": {
          "id": "361605fe-41d9-450b-bdf3-2c158102547a",
          "code": "nkk655",
          "identity": "d92a4fad-cd70-47d5-aed9-df71f060c66f",
          "parent_code": null,
          "child_codes": [],
          "is_active": false,
          "business": "604e1738-4716-4bdd-867b-4942186b1e1c",
          "created": "2018-05-22T23:37:32.514230Z",
          "updated": "2018-07-16T21:54:16.517731Z"
        },
        "identity_accredited_investor_status": null,
        "identity_json_objects": [],
        "errors": [],
        "created": "2018-07-16T21:54:16.359264Z",
        "updated": "2018-07-16T21:54:16.603646Z",
        "first_name": "John",
        "last_name": "Post",
        "middle_name": "B",
        "alias": "Johnny",
        "country_code": "US",
        "selected_country_code": "US",
        "locale": "en-US",
        "state": "new",
        "is_active": true,
        "death_date": "2016-01-01",
        "birth_location": "Dallas",
        "status": "unknown",
        "client_guid": "nkk655",
        "birth_date": "2001-11-22",
        "gender": "male",
        "height": null,
        "weight": null,
        "eye_color": null,
        "hair_color": null,
        "investor_type": null,
        "ssn": "",
        "medical_license": null,
        "insurance_license": null,
        "drivers_license": "",
        "passport_number": null,
        "is_accredited_investor": false,
        "title": null,
        "ownership_percentage": null,
        "notes": null,
        "source_of_wealth": null,
        "tax_id": null,
        "phone_is_validated": true,
        "transaction": "c99f15a1-b2ca-4ba0-87c6-7751b3e508ce",
        "business": null,
        "contenttype": 27
      },
      "transaction_metadata": {
        "id": 525,
        "alerts": [],
        "audit_logs": [],
        "created": "2018-07-16T21:54:07.169465Z",
        "updated": "2018-07-16T21:54:07.169483Z",
        "is_active": true,
        "country_code": null,
        "state": null,
        "gender": null,
        "birth_year": null,
        "locale": null,
        "app_name": null,
        "platform": null,
        "platform_version": null,
        "app_version": null,
        "sdk_version": null,
        "sanction_hits": null,
        "pep_hits": null,
        "media_hits": null,
        "face_match_score": null,
        "document_classifications": null,
        "provider_calls": null,
        "investor_type": null,
        "accredited_investor_status": null,
        "client_guid": null,
        "transaction": "c99f15a1-b2ca-4ba0-87c6-7751b3e508ce"
      },
      "transaction_callbacks": [],
      "required_fields": [],
      "errors": [],
      "created": "2018-07-16T21:54:07.160738Z",
      "updated": "2018-07-16T21:54:07.160757Z",
      "is_active": true,
      "state": "new",
      "notes": null,
      "contenttype": 29
    }
  ]
}
```


#### Restarted Code Characteristics

__NOTE:__ 

An access code may be considered _allocated_ but not _used_.  If an access code is a _child_ of a parent code then it must be considered allocated. 


When pulling codes from the API a code that is part of the restart flow will have a parent code ID. 


When someone hits the __RESTART__ button you will be sent a callback with the transaction including all the associated child tokens.  It is best practice to allocate that token immediately at that time so that it is not later assumed. 

In addition to the callback/transaction payload the data coming off the API will have the parent and child data associated to the records in that payload.  It inferred that if a code has a parent it must be given out to the same person/email/sms that is associated to the parent code.  


Example of a code that has a parent and is allocated to a previous transaction.

```javascript
{
  "updated": "2019-03-15T14:15:32.259285Z", 
  "code": "abc222", 
  "business": "BID", 
  "created": "2019-03-15T14:15:32.252862Z", 
  "is_active": true, 
  "child_codes": [], 
  "id": "CODE_ID", 
  "identity": null, 
  "parent_code": {
 "code": "hed111", 
 "is_active": false, 
 "identity": "IDENTITY_ID", 
 "created": "2019-02-26T17:24:04.495846Z"
  }
},
```

Example of code that is a parent and has associated child codes. 

```javascript
{
  "updated": "2019-03-14T20:41:00.960614Z", 
  "code": "abc111", 
  "business": "BID", 
  "created": "2019-02-26T17:24:04.495846Z", 
  "is_active": false, 
  "child_codes": [
 {
   "code": "abc222", 
   "is_active": true, 
   "identity": null, 
   "created": "2019-03-15T14:15:32.252862Z"
 }
  ], 
  "id": "CODE_ID", 
  "identity": "IDENTITY_ID", 
  "parent_code": null
}, 
```